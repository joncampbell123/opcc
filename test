dialect "intel-x86";

log ("cpulevel: " + value("cpulevel"));
log ("fpulevel: " + value("fpulevel"));

comment "---------------begin prefixes----------------";

prefix "CS:"
  (comment "Segment override prefix")
  (desc "CS segment override")
  (code 0x2E)
  (seg=cs);

prefix "DS:"
  (comment "Segment override prefix")
  (desc "DS segment override")
  (code 0x3E)
  (seg=ds);

prefix "ES:"
  (comment "Segment override prefix")
  (desc "ES segment override")
  (code 0x26)
  (seg=es);

if value("cpulevel") >= 386
prefix "FS:"
  (comment "386 Segment override prefix")
  (desc "FS segment override")
  (code 0x64)
  (seg=fs);
else
  log "No FS override";

if value("cpulevel") >= 386
prefix "GS:"
  (comment "386 Segment override prefix")
  (desc "GS segment override")
  (code 0x65)
  (seg=gs);
else
  log "No GS override";

prefix "SS:"
  (comment "Segment override prefix")
  (desc "SS segment override")
  (code 0x36)
  (seg=ss);

if value("cpulevel") >= 186 {;
  log "186 #UD and limit";
  unknown opcode ud;
  opcode limit 15;
} if;
else {;
  log "8086 no-#UD and no-limit";
  unknown opcode silent;
  opcode limit none;
} if;

comment "-----------------begin opcodes----------------";

opcode "PUSH"
  (comment "PUSH ES")
  (param=es)
  (code 0x06);

opcode "POP"
  (comment "POP ES")
  (dest=es)
  (code 0x07);

opcode "PUSH"
  (comment "PUSH CS")
  (param=cs)
  (code 0x0E);

if value("cpulevel") <= 86
opcode "POP"
  (comment "POP CS")
  (dest=cs)
  (code 0x0F);

opcode "PUSH"
  (comment "PUSH SS")
  (param=ss)
  (code 0x16);

opcode "POP"
  (comment "POP SS")
  (dest=ss)
  (code 0x17);

opcode "PUSH"
  (comment "PUSH DS")
  (param=ds)
  (code 0x1E);

opcode "POP"
  (comment "POP DS")
  (dest=ds)
  (code 0x1F);

opcode "DAA"
  (comment "DAA adjust AL after addition")
  (code 0x27);

opcode "DAS"
  (comment "DAS adjust AL after subtraction")
  (code 0x2F);

opcode "AAA"
  (comment "AAA ascii adjust AL after addition")
  (code 0x37);

opcode "AAD"
  (comment "AAD ascii adjust AX before division")
  (code 0x3F d=immediate(b));

